{% extends "layout.html" %} {% block content %}

<var id="result-container" class="result-container"></var>

<form id="search-everything" name="search-everything">
    <div class="typeahead__container">
        <div class="">
            <div class="typeahead__query">
                <input class="search-everything form-control" name="country_v1[query]" placeholder="Search everything..." autocomplete="off">
            </div>
            <div class="search__everything__button">
                <button class="btn btn-outline-success" type="submit">
                    <i class="typeahead__search-icon"></i>
                </button>
            </div>
        </div>
    </div>
</form>
<script type=text/javascript>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
{% raw %}
<script>
    $.typeahead({
        input: '.search-everything',
        order: "desc",
        dynamic: true,
        minLength: 3,
        delay: 500,
        selector: {
            button: "search__everything__button"
        },
        backdrop: {
            "background-color": "#fff"
        },
        template: function(query, item) {
            if (item.channel != null) {
                channel_label = ' - {{channel}} '
            }
            return '<span>{{name}}' + channel_label + '<small">(Type: {{type}}) <span class="text-muted">(uid: {{uid}})</span></small></span>'
        },
        emptyTemplate: "no result for {{query}}",
        source: {
            name: {
                display: "name",
                href: $SCRIPT_ROOT + "/view/{{unique_name}}",
                data: [{
                    "uid": 0,
                    "name": "not found"
                }],
                ajax: function(query) {
                    return {
                        type: "GET",
                        url: $SCRIPT_ROOT + "/_quicksearch",
                        path: "data",
                        data: {
                            q: "{{query}}"
                        }
                    }
                }
            }
        },
        callback: {
            // onClick: function(node, a, item, event) {

                // You can do a simple window.location of the item.href
               // alert(JSON.stringify(item));

            // },
            onSendRequest: function(node, query) {
                console.log('request is sent')
            },
            onReceiveRequest: function(node, query) {
                console.log('request is received')
            }
        },
        debug: true
    });
</script>
{% endraw %} {% endblock content %}