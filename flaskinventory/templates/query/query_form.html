{% set show_sidebar = True %}
{% extends "layout.html" %} 

{% block content %}

{% from "helpers/_viewhelpers.html" import render_publication %}


{% if result %}

<!--- Results Table --->

<table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">Name</th>
        <th scope="col">Type</th>
        <th scope="col">Country</th>
      </tr>
    </thead>
    <tbody>
    
      {% for entry in result %}
      <tr>
        {% if entry.get('dgraph.type')[0] in ["Tool", "Paper", "Dataset"] %}
          <td><span class="d-inline-block text-truncate" style="max-width: 400px;">{{ render_publication(entry) }}</td>
        {% else %}
          <td><a href="{{ url_for('view.view_generic', unique_name=entry.get('unique_name'), dgraph_type=entry.get('dgraph.type')[0])}}">{{ entry.name }} {{ entry.title }} {% if entry.get('channel') %}({{entry.channel.name }}){% endif %}</a></td>
        {% endif %}
          <td>{{ entry.get("dgraph.type")[0] }}</td>
          <td>
            {% if entry.get("country") %} 
                <span class="d-inline-block text-truncate" style="max-width: 250px;"
                title="{% for country in entry.country %}{{ country.name }}{{ ", " if not loop.last else "" }}{% endfor %}">
                {% for country in entry.country %}
                    {{ country.name }}{{ "," if not loop.last else "" }}
                {% endfor %}
                </span>
            {% endif %}
          </td>
      </tr>
      {% endfor %}
      </tbody>
  </table>

<!--- Pagination Nav --->
{% if pages > 1 %}
    <nav aria-label="Pagination" class="mt-4">
    <ul class="pagination">
        {% if current_page == 1 %}
            <li class="page-item disabled">
                <span class="page-link">&laquo;</span>
            </li>
            <li class="page-item disabled">
                <span class="page-link">&lsaquo;</span>
            </li>
        {% else %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('view.query_dev_result', _page=1, **r_args) }}" aria-label="First">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="{{ url_for('view.query_dev_result', _page=current_page-1, **r_args) }}" aria-label="Previous">
                    <span aria-hidden="true">&lsaquo;</span>
                </a>
            </li>
        {% endif %}

        {% if current_page - 3 > 1 %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
        {% endif %}
        
        {% for page in range(1, pages + 1) %}
            {% if page == current_page %}
                <li class="page-item active"><span class="page-link">{{ page }}</span></li>
            {% elif page > current_page-3 and page < current_page+3 %}
                <li class="page-item"><a class="page-link" href="{{ url_for('view.query_dev_result', _page=page, **r_args) }}">{{ page }}</a></li>
            {% else %}
            {% endif %}
        {% endfor %}

        {% if current_page + 3 <= pages %}
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
            {% if current_page + 3 < pages %}
                {% for page in range(pages -2, pages + 1) %}
                    <li class="page-item"><a class="page-link" href="{{ url_for('view.query_dev_result', _page=page, **r_args) }}">{{ page }}</a></li>
                {% endfor %}
            {% endif %}
        {% endif %}

        {% if current_page == pages %}
            <li class="page-item disabled">
                <span class="page-link">&rsaquo;</span>
            </li>
            <li class="page-item disabled">
                <span class="page-link">&raquo;</span>
            </li>
        {% else %}
            <li class="page-item">
                <a class="page-link" href="{{ url_for('view.query_dev_result', _page=current_page+1, **r_args) }}" aria-label="Next">
                <span aria-hidden="true">&rsaquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="{{ url_for('view.query_dev_result', _page=pages, **r_args) }}" aria-label="Last">
                <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        {% endif %}
    </ul>
    </nav>
{% endif %}


{% else %}

<p>No result!</p>

{% endif %}

{% endblock content %}


{% block sidebar %}


{% include "query/sidebar.html" %}

{% endblock sidebar %}